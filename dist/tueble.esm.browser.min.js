/*!
* tueble v1.4.0
* (c) 2019 Marcos Freire
* @license MIT
*/
function t(t,e){return Object.assign({},...e.map(e=>e in t?{[e]:t[e]}:{}))}class e{constructor(e){const r=t(e,["show","sortable","filterable","columnClass","label","index","highlight","columnHeaderClass"]);for(const t in r)this[t]=e[t];this.index&&(this.sortable=!1,this.filterable=!1,this.highlight=!1),this.isActive=!1,this.sortOrder=1,this.template=e.$scopedSlots.default}}class r{constructor(t,e){this.filterText=t,this.filterMinSize=e}isValid(){return"string"==typeof this.filterText&&this.filterText.length>=this.filterMinSize}}class i{constructor(e){const r=t(e,["filterBy","filterColumn"]);for(const t in r)this[t]=e[t]}isValid(){return this.filterBy.constructor===Array&&this.filterBy.length>0&&"string"==typeof this.filterColumn}}var n=function(t,e,r,i,n,o,s,l,a,d){"boolean"!=typeof s&&(a=l,l=s,s=!1);var u,c="function"==typeof r?r.options:r;if(t&&t.render&&(c.render=t.render,c.staticRenderFns=t.staticRenderFns,c._compiled=!0,n&&(c.functional=!0)),i&&(c._scopeId=i),o?(u=function(t){(t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),e&&e.call(this,a(t)),t&&t._registeredComponents&&t._registeredComponents.add(o)},c._ssrRegister=u):e&&(u=s?function(){e.call(this,d(this.$root.$options.shadowRoot))}:function(t){e.call(this,l(t))}),u)if(c.functional){var h=c.render;c.render=function(t,e){return u.call(e),h(t,e)}}else{var f=c.beforeCreate;c.beforeCreate=f?[].concat(f,u):[u]}return r};var o=n({render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("tr",t._l(t.columns,function(e){return r("tu-cell",{key:e.id,attrs:{column:e,"row-data":t.rowData,"row-index":t.rowIndex,"text-search":t.filterText}})}))},staticRenderFns:[]},void 0,{components:{"tu-cell":{functional:!0,props:["column","rowData","rowIndex","textSearch"],render(t,{props:e}){const r={};if(e.column.columnClass&&(r.class=e.column.columnClass),!e.column.index&&e.column.template)return t("td",r,e.column.template(e.rowData));r.domProps={};let i=e.column.index?e.rowIndex+1:e.column.highlight?(n=e.rowData[e.column.show],(o=e.textSearch)?n.toString().replace(new RegExp(o,"gi"),t=>'<span class="highlight">'+t+"</span>"):n):e.rowData[e.column.show];var n,o;return r.domProps.innerHTML=i,t("td",r)}}},props:{rowIndex:{required:!0,type:Number},columns:{required:!0,type:Array},rowData:{required:!0,type:Object},filterText:{required:!1,type:String,default:""}},computed:{showData:function(){return this}}},void 0,!1,void 0,void 0,void 0);var s=n({render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("th",{class:t.classNames,on:{click:t.clickAction}},[t._v("\n  "+t._s(t.column.label)+"\n  "),t.column.isActive?r("span",{domProps:{innerHTML:t._s(t.sortIcon)}}):t._e()])},staticRenderFns:[]},void 0,{props:{column:{required:!0,type:Object},columnIndex:{type:Number}},computed:{classNames(){return this.column.columnHeaderClass+(this.column.isActive?" header-active":"")+(this.column.index?" header-index":"")},sortIcon(){return 1==this.column.sortOrder?"&#9660;":"&#9650;"}},methods:{clickAction(){this.column.index||this.$emit("sortUpdate",this.columnIndex)}}},void 0,!1,void 0,void 0,void 0);var l=new class{filterArray(t,e,r,i,n,o=[]){const s=this.pluck(i.filter(t=>t.filterable),"show");n.isValid()&&(t=t.filter(function(t){return Object.keys(t).filter(function(t){return s.includes(t)}).some(function(e){return String(t[e]).toLowerCase().indexOf(n.filterText)>=0})})),o.filter(t=>t.isValid()).forEach(e=>{t=t.filter(t=>e.filterBy.includes(t[e.filterColumn]))}),e&&(t=t.slice().sort(function(t,i){return((t=t[e])===(i=i[e])?0:t>i?1:-1)*r}));let l=0;return t=t.map(t=>(t._id=l++,t))}pluck(t,e){return t.reduce(function(t,r){return t.concat(r[e])},[])}};var a=n({render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"tueble-component"},[r("table",{class:t.tableClass},[t.showCaption?r("caption"):t._e(),t._v(" "),0==t.filteredAndSortedData.length?r("p",{staticClass:"no-results"},[t._v(t._s(t.noDataText))]):t._e(),t._v(" "),r("thead",[r("tr",t._l(t.columns,function(e,i){return r("tu-column-header",{key:e.id,attrs:{column:e,"column-index":i},on:{sortUpdate:t.updateSortColumn}})}))]),t._v(" "),r("tbody",{class:t.tableBodyClass},t._l(t.filteredAndSortedData,function(e,i){return r("tu-row",{key:e._id,attrs:{columns:t.columns,"row-index":i,"row-data":e,"filter-text":t.filterText}})}))]),t._v(" "),r("div",{staticStyle:{display:"none"}},[t._t("default")],2)])},staticRenderFns:[]},void 0,{components:{"tu-row":o,"tu-column-header":s},props:{data:{required:!0,type:Array},showCaption:{required:!1,type:Boolean,default:!0},tableClass:{required:!1,type:String},tableBodyClass:{required:!1,type:String},filterText:{required:!1,type:String,default:""},filterMinSize:{required:!1,type:Number,default:2},defaultSortBy:{required:!1,type:String},defaultSortOrder:{required:!1,default:"asc",validator:function(t){return["asc","desc"].includes(t)}},noDataText:{required:!1,type:String,default:"No results found."}},data:()=>({columns:[],domainFilters:[],orderBy:null,orderAscDesc:1}),mounted(){this.columns=this.mapVueComponentsToObjects("tu-column","Column"),this.domainFilters=this.mapVueComponentsToObjects("filter-by-domain","DomainFilter"),this.defaultSortBy&&(this.orderBy=this.defaultSortBy,this.setDefaultColumn(this.defaultSortBy)),this.$on("filter-by-domain-changed",function(t){this.domainFilters=this.mapVueComponentsToObjects("filter-by-domain","DomainFilter")})},computed:{filteredAndSortedData:function(){let t=this.data,e=this.orderBy,i=this.orderAscDesc,n=new r(this.filterText,this.filterMinSize),o=this.domainFilters;return l.filterArray(t,e,i,this.columns,n,o)}},methods:{updateSortColumn:function(t){for(let e=0;e<this.columns.length;e++)e==t?(this.columns[e].isActive&&(this.columns[e].sortOrder=-1*this.columns[e].sortOrder),this.columns[e].isActive=!0,this.orderBy=this.columns[e].show,this.orderAscDesc=this.columns[e].sortOrder):this.columns[e].isActive=!1},setDefaultColumn:function(t){this.columns.forEach(e=>{e.show==t&&(e.isActive=!0,"asc"==this.defaultSortOrder&&(e.sortOrder=1),"desc"==this.defaultSortOrder&&(e.sortOrder=-1),this.orderAscDesc=e.sortOrder)})},mapVueComponentsToObjects:function(t,r){const n={Column:e,DomainFilter:i};return this.$children.filter(e=>e.$options.name==t).map(t=>new n[r](t))}}},void 0,!1,void 0,void 0,void 0);var d=n({render:function(){this.$createElement;this._self._c;return this._e()},staticRenderFns:[]},void 0,{name:"tu-column",props:{show:{type:String,required:!1},sortable:{type:Boolean,default:!0},filterable:{type:Boolean,default:!0},index:{type:Boolean,default:!1,required:!1},highlight:{type:Boolean,default:!1,required:!1},label:{type:String,required:!0},columnClass:{type:String,default:""},columnHeaderClass:{type:String,default:""}}},void 0,!1,void 0,void 0,void 0);var u=n({render:function(){this.$createElement;this._self._c;return this._e()},staticRenderFns:[]},void 0,{name:"filter-by-domain",props:{filterBy:{required:!0,type:Array,default:""},filterColumn:{required:!0,type:String}},watch:{filterBy(){this.$parent.$emit("filter-by-domain-changed",this.filterBy)}}},void 0,!1,void 0,void 0,void 0),c=Object.freeze({Tueble:a,Column:d,FilterByDomain:u});function h(t,e){return e?t.toString().replace(new RegExp(e,"gi"),t=>'<span class="highlight">'+t+"</span>"):t}const f={install:function t(e){t.installed||(t.installed=!0,Object.keys(c).forEach(t=>{e.component(t,c[t])}),e.filter("highlight",h))}};let m=null;"undefined"!=typeof window?m=window.Vue:"undefined"!=typeof global&&(m=global.Vue),m&&m.use(f);export default f;export{d as Column,u as FilterByDomain,h as HighlightText,a as Tueble};
