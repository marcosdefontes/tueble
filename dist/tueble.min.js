!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).Tueble={})}(this,function(e){"use strict";function t(e,t){return Object.assign({},...t.map(t=>t in e?{[t]:e[t]}:{}))}class r{constructor(e){const r=t(e,["show","sortable","filterable","columnClass","label","index","highlight","columnHeaderClass"]);for(const t in r)this[t]=e[t];this.index&&(this.sortable=!1,this.filterable=!1,this.highlight=!1),this.isActive=!1,this.sortOrder=1,this.template=e.$scopedSlots.default}}class i{constructor(e,t){this.filterText=e,this.filterMinSize=t}isValid(){return"string"==typeof this.filterText&&this.filterText.length>=this.filterMinSize}}class n{constructor(e){const r=t(e,["filterBy","filterColumn"]);for(const t in r)this[t]=e[t]}isValid(){return this.filterBy.constructor===Array&&this.filterBy.length>0&&"string"==typeof this.filterColumn}}var o=function(e,t,r,i,n,o,s,l,a,d){"boolean"!=typeof s&&(a=l,l=s,s=!1);var u,c="function"==typeof r?r.options:r;if(e&&e.render&&(c.render=e.render,c.staticRenderFns=e.staticRenderFns,c._compiled=!0,n&&(c.functional=!0)),i&&(c._scopeId=i),o?(u=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,a(e)),e&&e._registeredComponents&&e._registeredComponents.add(o)},c._ssrRegister=u):t&&(u=s?function(){t.call(this,d(this.$root.$options.shadowRoot))}:function(e){t.call(this,l(e))}),u)if(c.functional){var f=c.render;c.render=function(e,t){return u.call(t),f(e,t)}}else{var h=c.beforeCreate;c.beforeCreate=h?[].concat(h,u):[u]}return r};var s=o({render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("tr",e._l(e.columns,function(t){return r("tu-cell",{key:t.id,attrs:{column:t,"row-data":e.rowData,"row-index":e.rowIndex,"text-search":e.filterText}})}))},staticRenderFns:[]},void 0,{components:{"tu-cell":{functional:!0,props:["column","rowData","rowIndex","textSearch"],render(e,{props:t}){const r={};if(t.column.columnClass&&(r.class=t.column.columnClass),!t.column.index&&t.column.template)return e("td",r,t.column.template(t.rowData));r.domProps={};let i=t.column.index?t.rowIndex+1:t.column.highlight?(n=t.rowData[t.column.show],(o=t.textSearch)?n.toString().replace(new RegExp(o,"gi"),e=>'<span class="highlight">'+e+"</span>"):n):t.rowData[t.column.show];var n,o;return r.domProps.innerHTML=i,e("td",r)}}},props:{rowIndex:{required:!0,type:Number},columns:{required:!0,type:Array},rowData:{required:!0,type:Object},filterText:{required:!1,type:String,default:""}},computed:{showData:function(){return this}}},void 0,!1,void 0,void 0,void 0);var l=o({render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("th",{class:e.classNames,on:{click:e.clickAction}},[e._v("\n  "+e._s(e.column.label)+"\n  "),e.column.isActive?r("span",{domProps:{innerHTML:e._s(e.sortIcon)}}):e._e()])},staticRenderFns:[]},void 0,{props:{column:{required:!0,type:Object},columnIndex:{type:Number}},computed:{classNames(){return this.column.columnHeaderClass+(this.column.isActive?" header-active":"")+(this.column.index?" header-index":"")},sortIcon(){return 1==this.column.sortOrder?"&#9660;":"&#9650;"}},methods:{clickAction(){this.column.index||this.$emit("sortUpdate",this.columnIndex)}}},void 0,!1,void 0,void 0,void 0);var a=new class{filterArray(e,t,r,i,n,o=[]){const s=this.pluck(i.filter(e=>e.filterable),"show");n.isValid()&&(e=e.filter(function(e){return Object.keys(e).filter(function(e){return s.includes(e)}).some(function(t){return String(e[t]).toLowerCase().indexOf(n.filterText)>=0})})),o.filter(e=>e.isValid()).forEach(t=>{e=e.filter(e=>t.filterBy.includes(e[t.filterColumn]))}),t&&(e=e.slice().sort(function(e,i){return((e=e[t])===(i=i[t])?0:e>i?1:-1)*r}));let l=0;return e=e.map(e=>(e._id=l++,e))}pluck(e,t){return e.reduce(function(e,r){return e.concat(r[t])},[])}};var d=o({render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"tueble-component"},[r("table",{class:e.tableClass},[e.showCaption?r("caption"):e._e(),e._v(" "),0==e.filteredAndSortedData.length?r("p",{staticClass:"no-results"},[e._v(e._s(e.noDataText))]):e._e(),e._v(" "),r("thead",[r("tr",e._l(e.columns,function(t,i){return r("tu-column-header",{key:t.id,attrs:{column:t,"column-index":i},on:{sortUpdate:e.updateSortColumn}})}))]),e._v(" "),r("tbody",{class:e.tableBodyClass},e._l(e.filteredAndSortedData,function(t,i){return r("tu-row",{key:t._id,attrs:{columns:e.columns,"row-index":i,"row-data":t,"filter-text":e.filterText}})}))]),e._v(" "),r("div",{staticStyle:{display:"none"}},[e._t("default")],2)])},staticRenderFns:[]},void 0,{components:{"tu-row":s,"tu-column-header":l},props:{data:{required:!0,type:Array},showCaption:{required:!1,type:Boolean,default:!0},tableClass:{required:!1,type:String},tableBodyClass:{required:!1,type:String},filterText:{required:!1,type:String,default:""},filterMinSize:{required:!1,type:Number,default:2},defaultSortBy:{required:!1,type:String},defaultSortOrder:{required:!1,default:"asc",validator:function(e){return["asc","desc"].includes(e)}},noDataText:{required:!1,type:String,default:"No results found."}},data:()=>({columns:[],domainFilters:[],orderBy:null,orderAscDesc:1}),mounted(){this.columns=this.mapVueComponentsToObjects("tu-column","Column"),this.domainFilters=this.mapVueComponentsToObjects("filter-by-domain","DomainFilter"),this.defaultSortBy&&(this.orderBy=this.defaultSortBy,this.setDefaultColumn(this.defaultSortBy)),this.$on("filter-by-domain-changed",function(e){this.domainFilters=this.mapVueComponentsToObjects("filter-by-domain","DomainFilter")})},computed:{filteredAndSortedData:function(){let e=this.data,t=this.orderBy,r=this.orderAscDesc,n=new i(this.filterText,this.filterMinSize),o=this.domainFilters;return a.filterArray(e,t,r,this.columns,n,o)}},methods:{updateSortColumn:function(e){for(let t=0;t<this.columns.length;t++)t==e?(this.columns[t].isActive&&(this.columns[t].sortOrder=-1*this.columns[t].sortOrder),this.columns[t].isActive=!0,this.orderBy=this.columns[t].show,this.orderAscDesc=this.columns[t].sortOrder):this.columns[t].isActive=!1},setDefaultColumn:function(e){this.columns.forEach(t=>{t.show==e&&(t.isActive=!0,"asc"==this.defaultSortOrder&&(t.sortOrder=1),"desc"==this.defaultSortOrder&&(t.sortOrder=-1),this.orderAscDesc=t.sortOrder)})},mapVueComponentsToObjects:function(e,t){const i={Column:r,DomainFilter:n};return this.$children.filter(t=>t.$options.name==e).map(e=>new i[t](e))}}},void 0,!1,void 0,void 0,void 0);var u=o({render:function(){this.$createElement;this._self._c;return this._e()},staticRenderFns:[]},void 0,{name:"tu-column",props:{show:{type:String,required:!1},sortable:{type:Boolean,default:!0},filterable:{type:Boolean,default:!0},index:{type:Boolean,default:!1,required:!1},highlight:{type:Boolean,default:!1,required:!1},label:{type:String,required:!0},columnClass:{type:String,default:""},columnHeaderClass:{type:String,default:""}}},void 0,!1,void 0,void 0,void 0);var c=o({render:function(){this.$createElement;this._self._c;return this._e()},staticRenderFns:[]},void 0,{name:"filter-by-domain",props:{filterBy:{required:!0,type:Array,default:""},filterColumn:{required:!0,type:String}},watch:{filterBy(){this.$parent.$emit("filter-by-domain-changed",this.filterBy)}}},void 0,!1,void 0,void 0,void 0),f=Object.freeze({Tueble:d,Column:u,FilterByDomain:c});function h(e,t){return t?e.toString().replace(new RegExp(t,"gi"),e=>'<span class="highlight">'+e+"</span>"):e}const m={install:function e(t){e.installed||(e.installed=!0,Object.keys(f).forEach(e=>{t.component(e,f[e])}),t.filter("highlight",h))}};let p=null;"undefined"!=typeof window?p=window.Vue:"undefined"!=typeof global&&(p=global.Vue),p&&p.use(m),e.Column=u,e.FilterByDomain=c,e.HighlightText=h,e.Tueble=d,e.default=m,Object.defineProperty(e,"__esModule",{value:!0})});
